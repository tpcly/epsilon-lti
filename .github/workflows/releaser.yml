name: Release
on:
    workflow_call:
    workflow_dispatch:
        inputs:
            tag:
                description: "Tag"
                required: true
                default: "v0.0.0"
            draft:
                description: "Draft"
                required: true
                default: true
            prerelease:
                description: "Prerelease"
                required: true
                default: false
    push:
        tags:
            - "v*"
jobs:
    ci:
        permissions:
            actions: read
            contents: read
            security-events: write
        uses: ./.github/workflows/continuous-integration.yml
    tagged-release:
        runs-on: ubuntu-latest
        needs: [ ci ]
        permissions:
            contents: write
        steps:
            - uses: actions/checkout@v4
            - uses: ncipollo/release-action@v1
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  draft: ${{ inputs.draft || true }}
                  commit: ${{ github.sha }}
                  generateReleaseNotes: true
                  allowUpdates: true
                  tag: ${{ inputs.tag || github.ref_name }}
                  prerelease: ${{ inputs.prerelease || false }}               