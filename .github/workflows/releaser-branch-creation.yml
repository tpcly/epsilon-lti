name: Release Pull Request
on:
    push:
        branches:
            - 'release/**'
            - 'release/**-Beta.*'
env:
    CURRENT_BRANCH: ${{ github.ref }}
    APP_VERSION: ''
jobs:
    pull-request-creation:
        if: github.event.created
        permissions:
            contents: write
            pull-requests: write
        runs-on: ubuntu-latest
        steps:
            -   name: Extract branch name
                shell: bash
                run: echo "APP_VERSION=${GITHUB_REF##*/}" >> $GITHUB_ENV
            -   name: Checkout repository
                uses: actions/checkout@v3
            -   name: Update package.json version
                run: |
                    jq '.version = "${{ env.APP_VERSION }}"' Epsilon.Host.Frontend/package.json > Epsilon.Host.Frontend/package.json.tmp
                    mv Epsilon.Host.Frontend/package.json.tmp Epsilon.Host.Frontend/package.json        
        
            -   name: Create Pull Request
                uses: peter-evans/create-pull-request@v6
                with:
                    commit-message: Bump version package.json to ${{ env.APP_VERSION }}
                    branch: ${{ env.CURRENT_BRANCH }}
                    base: 'main'
                    title: ${{ env.APP_VERSION }}
                    body: |
                        This is an automated pull request to update the version of Epsilon to ${{ env.APP_VERSION }}.
                        The version is updated in the package.json file.
    